<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard – Eventos de Risco</title>
</head>
<body>

<h1>Dashboard – Eventos de Risco</h1>

<p id="status">Carregando eventos...</p>

<table border="1" cellpadding="8" cellspacing="0">
    <thead>
        <tr>
            <th>Data/Hora</th>
            <th>Classe Detectada</th>
            <th>Dispositivo (MAC)</th>
        </tr>
    </thead>
    <tbody id="eventos-body">
        <!-- Eventos entram aqui -->
    </tbody>
</table>

<script type="module">
    import { apiGet } from "./js/api.js";
    import { getToken, logout } from "./js/auth.js";

    // --------------------------------------------------
    // Validação de sessão
    // --------------------------------------------------
    if (!getToken()) {
        console.warn("Usuário não autenticado. Redirecionando...");
        logout();
    }

    // --------------------------------------------------
    // Carregamento dos eventos de risco
    // --------------------------------------------------
    async function carregarEventos() {
        const statusEl = document.getElementById("status");
        const tbodyEl = document.getElementById("eventos-body");

        try {
            const eventos = await apiGet("/api/monitoring/");

            tbodyEl.innerHTML = "";

            if (!eventos || eventos.length === 0) {
                statusEl.textContent = "Nenhum evento encontrado";
                return;
            }

            statusEl.textContent = "Eventos carregados com sucesso";

            eventos.forEach(evento => {
                const tr = document.createElement("tr");

                const tdData = document.createElement("td");
                tdData.textContent = evento.detected_at;

                const tdClasse = document.createElement("td");
                tdClasse.textContent = evento.detected_class;

                const tdMac = document.createElement("td");
                tdMac.textContent = evento.mac_address;

                tr.appendChild(tdData);
                tr.appendChild(tdClasse);
                tr.appendChild(tdMac);

                tbodyEl.appendChild(tr);
            });

        } catch (error) {
            statusEl.textContent = "Erro ao carregar eventos";
            console.error("Erro ao carregar eventos:", error);
        }
    }

    carregarEventos();
</script>

</body>
</html>
