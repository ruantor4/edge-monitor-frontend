<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Edge Monitor | Usuários</title>

    <!-- Bootstrap -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />

    <!-- Estilos globais -->
    <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

<!-- ======================================================
     HEADER GLOBAL
====================================================== -->
<header class="app-header">
    <h1>Edge Monitor</h1>

    <nav aria-label="Navegação principal">
        <a href="dashboard.html">Dashboard</a>
        <a href="users.html">Usuários</a>
        <button id="logout-btn">Sair</button>
    </nav>
</header>

<!-- ======================================================
     CONTEÚDO PRINCIPAL
====================================================== -->
<main class="dashboard-container">

    <!-- CABEÇALHO -->
    <section class="mb-4">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
            <div>
                <h2 class="fw-semibold mb-1">Gestão de Usuários</h2>
                <p class="text-muted mb-0">
                    Administração de usuários do sistema
                </p>
            </div>

            <div>
                <a href="user-form.html" class="btn btn-action">
                    Novo Usuário
                </a>
            </div>
        </div>
    </section>

    <!-- ==================================================
         TABELA DE USUÁRIOS
    =================================================== -->
    <section class="users-table-section">

        <div class="users-card-header">
            Usuários cadastrados
        </div>

        <div class="table-responsive">
            <table class="table users-table align-middle mb-0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Usuário</th>
                        <th>E-mail</th>
                        <th>
                            <div class="actions-wrapper">
                                Ações
                            </div>
                        </th>
                    </tr>
                </thead>

                <tbody id="users-table-body">
                    <!-- Linhas via JS -->
                </tbody>
            </table>
        </div>

        <p
            id="users-empty"
            class="text-muted mt-3"
            hidden
        >
            Nenhum usuário encontrado.
        </p>

    </section>

</main>

<!-- ======================================================
     SCRIPT
====================================================== -->
<script type="module">
    import { listUsers, deleteUser } from "./js/users.js";
    import { logout } from "./js/auth.js";

    const tableBody = document.getElementById("users-table-body");
    const emptyMessage = document.getElementById("users-empty");
    const logoutBtn = document.getElementById("logout-btn");

    logoutBtn.addEventListener("click", () => logout());

    async function loadUsers() {
        try {
            const users = await listUsers();

            if (!users.length) {
                emptyMessage.hidden = false;
                return;
            }

            users.forEach(user => {
                const row = document.createElement("tr");

                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email || "-"}</td>
                    <td>
                        <div class="actions-wrapper">
                            <a
                                href="user-form.html?id=${user.id}"
                                class="btn btn-outline-secondary btn-sm"
                            >
                                Editar
                            </a>
                            <button
                                class="btn btn-outline-danger btn-sm"
                                data-id="${user.id}"
                            >
                                Excluir
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });

        } catch {
            emptyMessage.textContent = "Erro ao carregar usuários.";
            emptyMessage.hidden = false;
        }
    }

    tableBody.addEventListener("click", async (event) => {
        const button = event.target;
        if (!button.matches("button[data-id]")) return;

        const userId = button.dataset.id;
        if (!confirm("Deseja realmente excluir este usuário?")) return;

        try {
            await deleteUser(userId);
            window.location.reload();
        } catch {
            alert("Erro ao excluir usuário");
        }
    });

    loadUsers();
</script>

</body>
</html>
